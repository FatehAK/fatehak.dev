---
import { getPicture } from '@astrojs/image';

const { alt, src } = Astro.props;

const isGif = src.format === 'gif';

const { image, sources } = await getPicture({
  src,
  alt,
  widths: [576, 768, 1200, 1400, 1600],
  // @ts-ignore
  formats: isGif ? ['gif'] : ['avif', 'webp'],
  fit: 'fill',
});

const children = await Astro.slots.render('default');
---

<figure class="my-9 break-padding">
  <picture>
    {sources.map(attrs => <source {...attrs} sizes="(max-width: 700px) calc(100vw - 0.6rem), calc(48rem - 2rem)" />)}
    <img class="rounded-[6px]" {...image} alt={image.alt} loading="lazy" decoding="async" />
  </picture>
  {children && <figcaption class="pt-2 text-center text-sm leading-[1.5] text-text-body/70" set:html={children} />}
</figure>
